"use strict";System.register("Pool",[],function(e,t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}var n,o;return{setters:[],execute:function(){n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?-1:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=o.clearMethodName,l=void 0===s?null:s,a=o.destroyMethodName,u=void 0===a?null:a,c=o.isFactory,h=void 0===c?!1:c;i(this,e),this.size=n,r(this,"ObjectConstructor",t),r(this,"objectClearMethodName",l),r(this,"objectDestroyMethodName",u),r(this,"objectConstructorIsFactory",h),r(this,"borrowedObjects",[]),r(this,"availableObjects",[]),r(this,"awaitCallbacks",[])}return n(e,[{key:"destroy",value:function(){this._destroyChildren(this.borrowedObjects),this._destroyChildren(this.availableObjects),this.awaitCallbacks.length&&this.awaitCallbacks.splice(0,this.awaitCallbacks.length)}},{key:"_destroyChildren",value:function(e){var t=this.objectDestroyMethodName||this.objectClearMethodName;if(!t)return void e.splice(0,e.length);for(var i=void 0;i=e.pop();)try{i[t].call(i)}catch(r){if("undefined"==typeof console)throw r;console.log("Error during destroy")}}},{key:"await",value:function(){var e=this;return this.hasAvailables()?Promise.resolve(this.borrows()):new Promise(function(t,i){e.awaitCallbacks.push(t)})}},{key:"borrows",value:function(){var e=null;return this.hasAvailables()&&(e=0===this.availableObjects.length?this.objectConstructorIsFactory?this.ObjectConstructor():new this.ObjectConstructor:this.availableObjects.pop(),this.borrowedObjects.push(e)),this._onObjectBorrowed&&this._onObjectBorrowed(),e}},{key:"returns",value:function(e){if(!(this.objectConstructorIsFactory||e instanceof this.ObjectConstructor))throw new Error("Can't return object which is not a "+this.ObjectConstructor.name);var t=this.borrowedObjects.indexOf(e);if(-1===t){if(this.availableObjects.indexOf(e)>-1)throw new Error(this.ObjectConstructor.name+" already returned !");throw new Error("Object given in Pool#returns() is not referenced in this Pool instance.")}if(this.borrowedObjects.splice(t,1),null!==this.objectClearMethodName)try{e[this.objectClearMethodName].call(e)}catch(i){if("undefined"==typeof console)throw i;console.log("Unable to call method "+this.objectClearMethodName+" on object instance "+String(e))}this.availableObjects.push(e),this._onObjectReturned&&this._onObjectReturned()}},{key:"hasAvailables",value:function(){return-1===this.size||this.borrowedObjects.length<this.size}},{key:"getCountAvailables",value:function(){return(-1===this.size?Number.MAX_SAFE_INTEGER:this.size)-this.getCountBorrowed()}},{key:"getCountBorrowed",value:function(){return this.borrowedObjects.length}},{key:"toString",value:function(){return"Pool<"+this.ObjectConstructor.name+">(borrowed: "+this.getCountBorrowed()+", available: "+this.getCountAvailables()+")"}},{key:"_onObjectReturned",value:function(){if(this.awaitCallbacks.length&&this.hasAvailables()){var e=this.awaitCallbacks.shift();e(this.borrows())}}}]),e}(),e("default",o)}}}),System.register("BufferedListItemView",["View"],function(e,t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o,s;return{setters:[function(e){o=e["default"]}],execute:function(){s=function(e){function t(){i(this,t);var e=r(this,Object.getPrototypeOf(t).call(this));return e.$el.addClass("item-view"),e}return n(t,e),t}(o),e("default",s),s.tagName="li",s.DESTROY_METHOD="destroy"}}}),System.register("BufferedListView",["jquery","bullet","View","BufferedListItemView","arrays"],function(e,t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o,s,l,a,u,c,h,d;return{setters:[function(e){o=e["default"]},function(e){s=e["default"]},function(e){l=e["default"]},function(e){a=e["default"]},function(e){u=e.createConstantArray}],execute:function(){c=function(){function e(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(a){n=!0,o=a}finally{try{!r&&l["return"]&&l["return"]()}finally{if(n)throw o}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),d=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,t);var n=r(this,Object.getPrototypeOf(t).call(this,e));return o.extend(n,s),Object.defineProperty(n,"_currentVisibleRange",{configurable:!0,writable:!1,value:u(0,0)}),n.isRendered=!1,n.listContainerSelector=e.listContainerSelector||".list-container:first > .list-display",n.scrollerContainerSelector=e.scrollerContainerSelector||".list-container:first",n.scrollPositionY=0,n.listHeight=e.listHeight||"auto",n.listHeightAutoMode="auto"===n.listHeight,n.listItemHeight=e.listItemHeight,n.idModelPropertyName=e.idModelPropertyName||"id",n.visibleOutboundItemsCount="number"!=typeof e.visibleOutboundItemsCount?2:e.visibleOutboundItemsCount,n.models=e.models||[],n.ItemConstructor=e.ItemConstructor||n.getItemConstructor(),n.viewsMap=new Map,n._onWindowResize=n.onResize.bind(n),o(window).on("resize",n._onWindowResize),n.listHeightAutoMode&&n.once("attach",function(){n.listHeight=n.queryListHeight(),n.isRendered&&(n.updateListScrollerHeight(),n.renderVisibleItems())}),n}return n(t,e),h(t,[{key:"destroy",value:function(){o(window).off("resize",this._onWindowResize),this.el&&delete this.el.__view__,this.$el&&this.remove(),this._onWindowResize=null,this.$listContainer=null,this.$scrollerContainer=null,this.models=null,this.$el=null,this.el=null}},{key:"setModels",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];this.models=e,this.updateListScrollerHeight(),this.renderVisibleItems()}},{key:"getItemConstructor",value:function(){return a}},{key:"template",value:function(){return'<div class="list-container"><div class="list-content"></div><ol class="list-display"></ol></div>'}},{key:"render",value:function(){this.$el.html(this.template()),this.isRendered=!0,this.$listContainer=this.$(this.listContainerSelector),this.$scrollerContainer=this.$(this.scrollerContainerSelector),this.$scrollerContainer.on("scroll",this.onScroll.bind(this)),this.isAttached&&(this.listHeightAutoMode&&(this.listHeight=this.queryListHeight()),this.updateListScrollerHeight(),this.renderVisibleItems())}},{key:"attachTo",value:function(e){o(e).append(this.$el),this.el.parentNode&&this.trigger("attach")}},{key:"scrollToIndex",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=e*this.listItemHeight;t.animate?this.$scrollerContainer.animate({scrollTop:i},t.duration||300):this.$scrollerContainer.scrollTop(i)}},{key:"queryListHeight",value:function(){return this.$el.outerHeight()}},{key:"updateListScrollerHeight",value:function(){this.$scrollerContainer.find(".list-content").height(this.models.length*this.listItemHeight)}},{key:"defineRangeOfModelsVisibles",value:function(){var e=Math.floor(this.scrollPositionY/this.listItemHeight),t=Math.ceil(this.listHeight/this.listItemHeight),i=Math.min(this.models.length-1,e+t);return[e,i]}},{key:"renderItemsRange",value:function(e){var t=this,i=c(e,2),r=i[0],n=i[1];if(this._currentVisibleRange[0]!==r||this._currentVisibleRange[1]!==n){var o=Math.max(0,r-this.visibleOutboundItemsCount),s=Math.min(this.models.length-1,n+this.visibleOutboundItemsCount),l=this.models.slice(o,s),a=l.map(function(e,i){var r=t.getView(e,o+Number(i));return r.el.setAttribute("data-index",r.indexInModelList),r});this.renderViews(a),Object.defineProperty(this,"_currentVisibleRange",{configurable:!0,writable:!1,value:u(r,n)}),this.constructor.DEV_MODE&&this.renderDebugInfos()}}},{key:"renderVisibleItems",value:function(){this.renderItemsRange(this.defineRangeOfModelsVisibles())}},{key:"renderViews",value:function(e){var t=this.$listContainer.children().toArray().map(function(e){return e.__view__});if(0===t.length)this.addViews(e);else{var i=t.filter(function(t){return!e.includes(t)}),r=e;this.removeViews(i),this.addViews(r)}}},{key:"getView",value:function(e,t){var i=this.viewsMap.get(e[this.idModelPropertyName]);if("undefined"==typeof this.idModelPropertyName)throw new Error("BufferedListView#idModelPropertyName must be defined");if("undefined"==typeof e[this.idModelPropertyName])throw new Error("The model."+this.idModelPropertyName+" is undefined. There is no chance to show more than one view.");return i||(i=new this.ItemConstructor,i.model=e,i.indexInModelList=t,i.render(),this.viewsMap.set(e[this.idModelPropertyName],i)),i}},{key:"removeViews",value:function(e){for(var t=0;t<e.length;t++)this.removeView(e[t])}},{key:"removeView",value:function(e){this.viewsMap["delete"](e.model[this.idModelPropertyName]),e[this.ItemConstructor.DESTROY_METHOD]()}},{key:"addViews",value:function(e){for(var t=0;t<e.length;t++)this.addView(e[t],t)}},{key:"addView",value:function(e,t){var i=this.$listContainer,r=i.children(),n=this.listItemHeight*e.indexInModelList;e.el.style.top=String(n)+"px",r.length<=t?i.append(e.el):0===t?i.prepend(e.el):o(i.children().get(t)).after(e.el)}},{key:"onResize",value:function(e){this._onResize(e),this.renderVisibleItems()}},{key:"onScroll",value:function(e){this._onScroll(e)}},{key:"_onResize",value:function(e){this.listHeightAutoMode&&(this.listHeight=this.queryListHeight())}},{key:"_onScroll",value:function(e){this.scrollPositionY=this.$scrollerContainer.scrollTop(),this.renderVisibleItems()}},{key:"renderDebugInfos",value:function(){var e=this.defineRangeOfModelsVisibles(),t=c(e,2),i=t[0],r=t[1];o("#debug-container").html("\n<div>Visible range: ("+i+", "+r+")</div>\n<div>Visible models: ("+Math.max(0,i-this.visibleOutboundItemsCount)+", "+Math.min(this.models.length-1,r+this.visibleOutboundItemsCount)+")")}}]),t}(l),e("default",d)}}}),System.register("View",["jquery"],function(e,t){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r,n,o;return{setters:[function(e){r=e["default"]}],execute:function(){n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(){function e(){i(this,e),this.$el=r(this.el=document.createElement(this.constructor.tagName||"div")),this.$el.addClass("view"),this.el.__view__=this}return n(e,[{key:"isAttached",get:function(){return!!this.el&&!!this.el.parentNode}}]),n(e,[{key:"destroy",value:function(){this.el&&(this.el.__view__=null,this.remove()),this.el=this.$el=this.model=null}},{key:"$",value:function(){return this.$el.find.apply(this.$el,arguments)}},{key:"clear",value:function(){this.remove(),this.el.innerHTML="",this.model=null}},{key:"remove",value:function(){this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},{key:"template",value:function(){return String(this.indexInModelList)}},{key:"render",value:function(){this.el.innerHTML=this.template()}}]),e}(),e("default",o)}}}),System.register("arrays",[],function(e,t){return{setters:[],execute:function(){function t(){for(var e=arguments.length,t=Array(e),i=0;e>i;i++)t[i]=arguments[i];for(var r=new Array(t.length),n=0;n<t.length;n++)Object.defineProperty(r,n,{configurable:!1,writable:!1,enumerable:!0,value:t[n]});return r}e("createConstantArray",t)}}}),System.register("buffered-list-view.jquery",["jquery","BufferedListView","BufferedListItemView"],function(e,t){function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o,s,l,a,u,c;return{setters:[function(e){o=e["default"]},function(e){s=e["default"]},function(e){l=e["default"]}],execute:function(){a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=["listContainerSelector","scrollerContainerSelector","listHeight","listItemHeight","visibleOutboundItemsCount","models","maxPoolSize","idModelPropertyName","ItemConstructor"],c=function(){function e(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];n(this,e),this.$container=t,this.options=i,this.createListView(),this.render()}return a(e,[{key:"getAttribute",value:function(e){return this.options[e]}},{key:"setAttribute",value:function(e,t){var i=this.options[e];this.options[e]=t,"function"==typeof this["_"+e+"Changed"]&&this["_"+e+"Changed"].call(this,i,t)}},{key:"createListView",value:function(){options.ItemConstructor=this.generateItemView(this.getAttribute("template")),this.listview=new s(options)}},{key:"recreateListView",value:function(){this.listview&&this.listview.destroy(),this.createListView(),this.render()}},{key:"render",value:function(){this.listview.$el.parent().get(0)!==this.$container.get(0)&&this.$container.append(this.listview.$el),this.listview.render()}},{key:"generateItemView",value:function(e){var t=function(e){function t(){return n(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return r(t,e),a(t,[{key:"clear",value:function(){this.model=null}}]),t}(l);return t.CLEAR_METHOD="clear",t.DESTROY_METHOD="clear",t.prototype.template=e,t}},{key:"_htmlChanged",value:function(e,t){e!==t&&this.recreateListView()}},{key:"_dataChanged",value:function(e,t){this.listview.setModels(t)}}]),e}(),o.fn.bufferedListView=function(e,t){if("string"==typeof e)return this.prop("buffered-list-view")?void 0!==t?(this.prop("buffered-list-view").setAttribute(e,t),this):this.prop("buffered-list-view").getAttribute(e):this;var i=e;return this.prop("buffered-list-view",new c(this,i)),this}}}});